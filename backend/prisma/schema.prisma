datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

// Enums
enum ProfilSortieEnum {
  Front
  Back
  Fullstack
  Designer
  Cm
  Integrateur
}

// Modèles
model Profile {
  id    Int     @id @default(autoincrement())
  nomP  String
  users User[]
}

model User {
  id            Int              @id @default(autoincrement())
  nom           String
  prenom        String
  email         String           @unique
  profil        Profile           @relation(fields: [profilId], references: [id])
  profilId      Int
  promos        Promo[]          @relation("PromoFormateurs")
  profilSortie  ProfilSortie?    @relation(fields: [profilSortieId], references: [id])
  profilSortieId Int?
}

model Promo {
  id           Int          @id @default(autoincrement())
  nom          String
  annee        String
  referentiels Referentiel[]
  formateurs   User[]       @relation("PromoFormateurs")
}

model Referentiel {
  id            Int                  @id @default(autoincrement())
  nom           String
  refCompetences RefCompetences[]    // Remplacez `competences` par `refCompetences`
  promos        Promo[]
}

model Competence {
  id            Int                  @id @default(autoincrement())
  description   String
  niveaux       Niveau[]
  refCompetences RefCompetences[]    // Remplacez `referentiel` par `refCompetences`
}

model Niveau {
  id          Int         @id @default(autoincrement())
  nom         String
  competences Competence[]
}

model Tag {
  id      Int     @id @default(autoincrement())
  libelle String
}

model ProfilSortie {
  id    Int             @id @default(autoincrement())
  nom   ProfilSortieEnum @unique
  users User[]
}

// Table de jointure pour Referentiel ↔ Competence
model RefCompetences {
  referentiel   Referentiel @relation(fields: [referentielId], references: [id])
  referentielId Int
  competence    Competence  @relation(fields: [competenceId], references: [id])
  competenceId  Int

  @@id([referentielId, competenceId])
}
